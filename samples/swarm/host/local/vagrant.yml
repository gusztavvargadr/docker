---
defaults:
  machines:
    core: &machine_core
      providers:
        virtualbox:
        hyperv:
      synced_folders:
        ../../../engine/guest: /vagrant-docker-engine
        ../../guest: /vagrant-docker-swarm
    u14: &machine_u14
      <<: *machine_core
      box: gusztavvargadr/u14
    w16sc: &machine_w16sc
      <<: *machine_core
      box: gusztavvargadr/w16sc-de

environment: host.swarm.samples.docker

machines:
  bootstrap:
    <<: *machine_u14
    provisioners:
      docker:
      shell:
        path: init.sh
        args: eth0
  manager:
    <<: *machine_u14
    provisioners:
      docker:
      shell:
        path: join.sh
        args:
          - bootstrap
          - <%= ENV['DOCKER_SWARM_MANAGER_TOKEN'] %>
    count: 3
  worker-u14:
    <<: *machine_u14
    provisioners:
      docker:
      shell:
        path: join.sh
        args:
          - manager
          - <%= ENV['DOCKER_SWARM_WORKER_TOKEN'] %>
    count: 2
  worker-w16sc:
    <<: *machine_w16sc
    provisioners:
      shell:
        path: join.ps1
        args:
          - manager.host.swarm.samples.docker.local
          - <%= ENV['DOCKER_SWARM_WORKER_TOKEN'] %>
    count: 2
