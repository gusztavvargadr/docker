component: swarm

hostmanager: true

machines:
  bootstrap:
    synced_folders:
      /src:
        source: ../../..
    aliases:
      - join
    provisioners:
      shell_machine_configuration:
        inline: <%= "cd /src/samples/images; ./build.sh docker-machine-configuration; docker run -v /vagrant/.docker/machine:/data gusztavvargadr/docker-machine-configuration bootstrap,manager,linux,windows swarm.docker.sandbox.local #{Dir.pwd}/.docker" %>
      shell_server:
        inline: cd /vagrant/.docker/machine; ./server.sh bootstrap
      shell_init:
        path: init.sh
        args: eth0
  manager:
    box: <%= VagrantLinuxServerMachine.defaults['box'] %>
    provisioners:
      shell_server:
        inline: cd /vagrant/.docker/machine; ./server.sh manager
      shell_join:
        path: join.sh
        args:
          - join.swarm.docker.sandbox.local
          - manager
  linux:
    provisioners:
      shell_server:
        inline: cd /vagrant/.docker/machine; ./server.sh linux
      shell_join:
        path: join.sh
        args:
          - join.swarm.docker.sandbox.local
          - worker
  windows:
    provisioners:
      shell_server:
        inline: cd /vagrant/.docker/machine; ./server.ps1 windows
      shell_join:
        path: join.ps1
        args:
          - join.swarm.docker.sandbox.local
          - worker
