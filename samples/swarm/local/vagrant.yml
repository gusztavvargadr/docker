component: swarm
stack: docker

hostmanager: true

machines:
  bootstrap:
    box: <%= VagrantLinuxServerMachine.defaults['box'] %>
    synced_folders:
      /src/gusztavvargadr/docker:
        source: ../../..
    aliases:
      - manager-join
    provisioners:
      shell_machine_configuration:
        inline: <%= "cd /src/gusztavvargadr/docker/samples/images; ./build.sh docker-machine-configuration; docker run -v /data/docker/machine:/data gusztavvargadr/docker-machine-configuration bootstrap,manager,linux,windows swarm.docker.vagrant.local #{Dir.pwd}" %>
      shell_server:
        inline: cd /data/docker/machine; ./server.sh bootstrap
      shell_init:
        path: init.sh
        args: eth0
  manager:
    box: <%= VagrantLinuxServerMachine.defaults['box'] %>
    provisioners:
      shell_server:
        inline: cd /data/docker/machine; ./server.sh manager
      shell_join:
        path: join.sh
        args:
          - manager-join
          - manager
  linux:
    provisioners:
      shell_server:
        inline: cd /data/docker/machine; ./server.sh linux
      shell_join:
        path: join.sh
        args:
          - manager-join
          - worker
  windows:
    provisioners:
      shell_join:
        path: join.ps1
        args:
          - manager-join
          - worker
      shell_server:
        inline: cd /data/docker/machine; ./server.ps1 windows
